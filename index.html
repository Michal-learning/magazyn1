<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport" />
    <title>Magazyn PRO</title>
    <meta content="System zarządzania magazynem i produkcją" name="description" />
    <link href="style.css" rel="stylesheet" />
</head>
<body>
    <main class="appShell">
        <div class="appMain">
            <header class="top">
                <div class="header-content">
                    <h1>Magazyn <span class="accent">PRO</span></h1>
                    <p class="small muted">
                        Zasada: <strong>Nazwa (ID)</strong> to unikalny identyfikator. <strong>Typ</strong> to opis/kategoria.
                        Zużycie: <strong>FIFO</strong>.
                    </p>
                </div>

                <nav class="tabsBar" aria-label="Nawigacja">

                    <div class="tabGroup">
                        <div class="tabGroupLabel">MAGAZYN</div>
                        <div class="tabGroupButtons">
                            <button class="tabBtn active" type="button" data-tab-target="parts">
                                Magazyn
                                Części
                            </button>
                            <button class="tabBtn" type="button" data-tab-target="machines">Magazyn Maszyn</button>
                        </div>
                    </div>

                    <div class="tabDivider" aria-hidden="true"></div>

                    <div class="tabGroup">
                        <div class="tabGroupLabel">OPERACJE</div>
                        <div class="tabGroupButtons">
                            <button class="tabBtn" type="button" data-tab-target="delivery">Nowa Dostawa</button>
                            <button class="tabBtn" type="button" data-tab-target="build">Produkcja</button>
                        </div>
                    </div>


                    <div class="tabDivider" aria-hidden="true"></div>

                    <div class="tabGroup">
                        <div class="tabGroupLabel">Historia</div>
                        <div class="tabGroupButtons">
                            <button class="tabBtn" type="button" data-tab-target="history">Ostatnie akcje</button>
                        </div>
                    </div>

                    <div class="tabDivider" aria-hidden="true"></div>

                    <div class="tabGroup">
                        <div class="tabGroupLabel">Katalogi / Ustawienia</div>
                        <div class="tabGroupButtons">
                            <button class="tabBtn" type="button" data-tab-target="catalog_parts">Baza Części</button>
                            <button class="tabBtn" type="button" data-tab-target="catalog_suppliers">Dostawcy</button>
                            <button class="tabBtn" type="button" data-tab-target="catalog_machines">Definicje Maszyn (BOM)</button>
                        </div>
                    </div>
                </nav>
            </header>

            <section class="tabPanel widePanel" data-tab-panel="parts">
                <div class="card">
                    <div class="cardHeader">
                        <h2>Magazyn Części</h2>
                        <div class="toolbarRight">
                            <button class="secondary compact" id="toggleThresholdsBtn" type="button">Progi</button>
                            <button class="secondary compact" id="clearDataBtn" type="button">Resetuj system</button>
                        </div>
                    </div>

                    <div class="thresholds slidePanel collapsed" id="thresholdsPanel">
                        <div class="thresholdRow">
                            <label>Ostrzeżenie (żółty): <strong id="warnValue">100</strong> szt.</label>
                            <input id="warnRange" max="1000" min="0" step="10" type="range" value="100" />
                        </div>
                        <div class="thresholdRow">
                            <label>Krytyczny (czerwony): <strong id="dangerValue">50</strong> szt.</label>
                            <input id="dangerRange" max="1000" min="0" step="10" type="range" value="50" />
                        </div>
                    </div>

                    <div class="toolbar partsToolbar">
                        <input id="searchParts" placeholder="Szukaj po Nazwie/Typie/Dostawcy..." type="text" autocomplete="off" />

                        <div class="segmented" role="tablist" aria-label="Widok magazynu części">
                            <button id="partsViewCompactBtn" type="button" class="secondary compact" role="tab" aria-selected="true">
                                Podsumowanie
                            </button>
                            <button id="partsViewBatchesBtn" type="button" class="secondary compact" role="tab" aria-selected="false">
                                Szczegóły
                            </button>
                        </div>
                    </div>

                    <div id="partsSplit" class="partsSplit" data-view="compact">
                        <section class="splitCol splitCol--compact">
                            <h3 class="subhead">Podsumowanie (wg Nazwy/ID)</h3>
                            <div class="tableWrap">
                                <table id="skuSummaryTable" class="tightTable stickyHeader">
                                    <thead>
                                        <tr>
                                            <th>Nazwa (ID)</th>
                                            <th>Typ</th>
                                            <th class="right">Stan</th>
                                            <th class="right">Wartość</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </section>

                        <section class="splitCol splitCol--batches">
                            <h3 class="subhead">Szczegóły Partii (FIFO)</h3>
                            <div class="tableWrap">
                                <div class="summaryRow">
                                    <div class="muted small">Wartość całkowita:</div>
                                    <div class="right"><strong id="warehouseTotal">0,00 zł</strong></div>
                                </div>

                                <table id="partsTable" class="tightTable stickyHeader">
                                    <thead>
                                        <tr>
                                            <th>Nazwa (ID)</th>
                                            <th>Dostawca</th>
                                            <th class="right">Cena zak.</th>
                                            <th class="right">Ilość</th>
                                            <th class="right">Wartość</th>
                                            <th class="right"></th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </section>
                    </div>


                </div>
            </section>

            <section class="tabPanel" data-tab-panel="delivery" hidden>
                <div class="card">
                    <div class="cardHeader">
                        <h2>Przyjęcie Dostawy</h2>
                        <p class="small muted">Wybierz dostawcę i dodaj towary do listy przyjęcia.</p>
                    </div>

                    <div class="grid2">
                        <div class="uiSection">
                            <div class="row">
                                <label>
                                    Dostawca
                                    <select id="supplierSelect"></select>
                                </label>
                                <label>
                                    Data przyjęcia
                                    <input id="deliveryDate" type="date" required />
                                </label>
                            </div>
                            <div class="row">
                                <label>
                                    Wybierz część (Nazwa - Typ)
                                    <select id="supplierPartsSelect"></select>
                                </label>
                            </div>
                            <div class="row items-end">
                                <label>
                                    Ilość
                                    <input id="deliveryQty" min="1" step="1" type="number" value="1" />
                                </label>
                                <label>
                                    Cena jedn. (PLN)
                                    <input id="deliveryPrice" min="0" step="0.01" type="number" value="0" />
                                </label>
                                <button id="addDeliveryItemBtn" type="button" class="secondary">Dodaj pozycję</button>
                            </div>
                        </div>

                        <div class="uiSection listSection">
                            <div class="tableWrap">
                                <table id="deliveryItemsTable">
                                    <thead>
                                        <tr>
                                            <th>Nazwa (ID)</th>
                                            <th class="right">Ilość</th>
                                            <th class="right">Cena</th>
                                            <th class="right">Razem</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                            <div class="deliveryActions">
                                <div class="summary">
                                    <div><span>Pozycji:</span> <strong id="itemsCount">0</strong></div>
                                    <div><span>Do zapłaty:</span> <strong id="itemsTotal">0,00 zł</strong></div>
                                </div>
                                <button class="primary" id="finalizeDeliveryBtn" type="button" disabled>Zatwierdź dostawę</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="tabPanel" data-tab-panel="build" hidden>
                <div class="card">
                    <div class="cardHeader">
                        <h2>Zlecenie Produkcyjne</h2>
                        <p class="small muted">Zaplanuj produkcję. System automatycznie zdejmie części ze stanu (FIFO).</p>
                    </div>

                    <div class="grid2">
                        <div class="uiSection">
                            <div class="row">
                                <label>
                                    Wybierz maszynę
                                    <select id="machineSelect"></select>
                                </label>
                            </div>
                            <div class="row items-end">
                                <label>
                                    Ilość sztuk
                                    <input id="buildQty" min="1" step="1" type="number" value="1" />
                                </label>
                                <label>
                                    Data produkcji
                                    <input id="buildDate" type="date" />
                                </label>
                                <button id="addBuildItemBtn" type="button" class="secondary">Dodaj do planu</button>
                            </div>

                            <hr class="divider">

                            <div class="row">
                                <label>
                                    Tryb pobierania części
                                    <select id="consumeMode">
                                        <option selected value="fifo">Automatyczny (FIFO)</option>
                                        <option value="manual">Ręczny wybór partii</option>
                                    </select>
                                </label>
                            </div>

                            <div class="missingBox" hidden id="missingBox">
                                <strong>Braki magazynowe!</strong>
                                <p class="small">Nie można wyprodukować. Brakuje następujących części:</p>
                                <ul class="small" id="missingList"></ul>
                            </div>
                        </div>

                        <div class="uiSection listSection">
                            <div class="tableWrap">
                                <table id="buildItemsTable">
                                    <thead>
                                        <tr>
                                            <th>Maszyna</th>
                                            <th class="right">Ilość</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>

                            <div class="missingBox infoBox" hidden id="manualConsumeBox">
                                <strong>Wybór partii (Manual)</strong>
                                <div id="manualConsumeUI" class="manualConsumeGrid"></div>
                            </div>

                            <div class="deliveryActions">
                                <div class="summary">
                                    <div><span>Maszyn do zrobienia:</span> <strong id="buildItemsCount">0</strong></div>
                                </div>
                                <button class="primary" id="finalizeBuildBtn" type="button" disabled>Finalizuj produkcję</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="tabPanel" data-tab-panel="machines" hidden>
                <div class="card">
                    <div class="cardHeader">
                        <h2>Magazyn Wyrobów Gotowych</h2>
                    </div>
                    <div class="toolbar">
                        <input id="searchMachines" placeholder="Szukaj po Nazwie/Typie..." type="text" autocomplete="off" />
                    </div>
                    <div class="tableWrap">
                        <table id="machinesStockTable">
                            <thead>
                                <tr>
                                    <th>Nazwa Maszyny (ID)</th>
                                    <th>Typ</th>
                                    <th class="right">Magazyn Części</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section class="tabPanel" data-tab-panel="catalog_parts" hidden>
                <div class="card">
                    <h2>Baza Części (Globalna)</h2>
                    <div class="uiSection">
                        <div class="uiSectionHead">
                            <h3>Nowa Część</h3>
                            <span class="uiHint">Definiujesz tylko raz.</span>
                        </div>
                        <div class="row items-end">
                            <label>
                                Nazwa (Unikalne ID)
                                <input id="partSkuInput" placeholder="np. SR-M6-30" type="text" autocomplete="off" />
                            </label>
                            <label>
                                Typ (Opis)
                                <input id="partNameInput" placeholder="np. Śruba M6x30" type="text" autocomplete="off" />
                            </label>
                        </div>

                        <div class="miniSubhead" style="margin-top:10px; margin-bottom:5px; font-size:0.9rem; color:var(--muted)">
                            Przypisz do istniejących dostawców:
                        </div>

                        <div id="partNewSuppliersChecklist" class="comboMulti" data-combo="suppliers">
                            <span class="small muted">Brak zdefiniowanych dostawców. Dodaj ich w zakładce "Dostawcy".</span>
                        </div>

                        <div id="newPartSupplierPrices" class="supplierPricePanel" hidden>
                            <div class="supplierPriceHead">
                                <div class="small muted">Ceny dla zaznaczonych dostawców</div>
                                <div class="small muted">PLN / szt.</div>
                            </div>
                            <div class="supplierPriceBody"></div>
                        </div>

                        <div class="row">
                            <button id="addPartBtn" type="button" class="compact primary">Zapisz w bazie</button>
                        </div>
                    </div>


                    <div class="uiSection editorPanel collapsed" id="partEditSection" hidden>
                        <div class="uiSectionHead">
                            <h3 id="partEditTitle">Edycja Części</h3>
                            <span class="uiHint">Zapisz albo anuluj. SKU jest stałe.</span>
                        </div>

                        <div class="row items-end">
                            <label>
                                Nazwa (Unikalne ID)
                                <input id="editPartSkuInput" placeholder="np. SR-M6-30" type="text" autocomplete="off" readonly />
                            </label>
                            <label>
                                Typ (Opis)
                                <input id="editPartNameInput" placeholder="np. Śruba M6x30" type="text" autocomplete="off" />
                            </label>
                        </div>

                        <div class="miniSubhead" style="margin-top:10px; margin-bottom:5px; font-size:0.9rem; color:var(--muted)">
                            Przypisz do istniejących dostawców:
                        </div>

                        <div id="editPartSuppliersChecklist" class="comboMulti" data-combo="suppliers">
                            <span class="small muted">Brak zdefiniowanych dostawców.</span>
                        </div>

                        <div id="editPartSupplierPrices" class="supplierPricePanel" hidden>
                            <div class="supplierPriceHead">
                                <div class="small muted">Ceny dla zaznaczonych dostawców</div>
                                <div class="small muted">PLN / szt.</div>
                            </div>
                            <div class="supplierPriceBody"></div>
                        </div>

                        <div class="row" style="gap:10px;">
                            <button id="saveEditPartBtn" type="button" class="success">Zapisz zmiany</button>
                            <button id="cancelEditPartBtn" type="button" class="secondary">Anuluj</button>
                        </div>
                    </div>
                    <div class="tableWrap">
                        <table id="partsCatalogTable">
                            <thead>
                                <tr>
                                    <th>Nazwa (ID)</th>
                                    <th>Typ</th>
                                    <th>Dostawcy (Przypisani)</th>
                                    <th class="right">Akcje</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section class="tabPanel" data-tab-panel="catalog_suppliers" hidden>
                <div class="card">
                    <h2>Dostawcy i Cenniki</h2>

                    <div class="grid2">
                        <div>
                            <div class="uiSection">
                                <div class="row items-end">
                                    <label>
                                        Nazwa dostawcy
                                        <input id="supplierNameInput" placeholder="np. Hurtownia X" type="text" autocomplete="off" />
                                    </label>
                                    <button id="addSupplierBtn" type="button" class="compact primary">Dodaj</button>
                                </div>
                            </div>
                            <div class="tableWrap">
                                <table id="suppliersListTable">
                                    <thead>
                                        <tr>
                                            <th>Dostawca</th>
                                            <th class="right">Akcje</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>

                        <div id="supplierEditorTemplate" class="uiSection editorPanel" hidden>
                            <div class="uiSectionHead">
                                <h3>Edycja cennika: <span id="supplierEditorName" class="accent">—</span></h3>
                            </div>

                            <div class="row items-end">
                                <label>
                                    Wybierz część
                                    <select id="supplierEditorPartSelect"></select>
                                </label>
                                <label style="max-width: 100px;">
                                    Cena
                                    <input id="supplierEditorPriceInput" min="0" step="0.01" type="number" value="0" />
                                </label>
                                <button id="supplierEditorSetPriceBtn" type="button" class="compact">Ustaw</button>
                            </div>

                            <div class="tableWrap" style="max-height: 300px; overflow-y: auto;">
                                <table class="tightTable">
                                    <thead>
                                        <tr>
                                            <th>Nazwa (ID)</th>
                                            <th>Typ</th>
                                            <th>Cena PLN</th>
                                        </tr>
                                    </thead>
                                    <tbody id="supplierEditorPriceBody"></tbody>
                                </table>
                            </div>

                            <div class="editorActions">
                                <button id="supplierEditorSaveBtn" type="button" class="success">Zapisz zmiany</button>
                                <button id="supplierEditorCancelBtn" type="button" class="secondary">Anuluj</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="tabPanel" data-tab-panel="catalog_machines" hidden>
                <div class="card">
                    <h2>Definicje Maszyn (BOM)</h2>
                    <p class="small muted">Bill of Materials - z czego składa się jedna sztuka maszyny.</p>

                    <div class="uiSection">
                        <div class="uiSectionHead">
                            <h3>Nowa definicja</h3>
                        </div>
                        <div class="row items-end">
                            <label>
                                Nazwa Maszyny (ID/Kod)
                                <input id="machineCodeInput" type="text" placeholder="np. M-100" autocomplete="off" />
                            </label>
                            <label>
                                Typ (Nazwa handlowa)
                                <input id="machineNameInput" type="text" placeholder="np. Wiertarka Stołowa" autocomplete="off" />
                            </label>
                            <button id="addMachineBtn" type="button" class="compact primary">Utwórz</button>
                        </div>
                    </div>

                    <div id="machineEditorTemplate" class="uiSection editorPanel" hidden>
                        <div class="uiSectionHead">
                            <h3>Edycja BOM: <span id="machineEditorName" class="accent">—</span> <span id="machineEditorCode" class="badge"></span></h3>
                        </div>

                        <select id="machineManageSelect" hidden></select>

                        <div class="row items-end">
                            <label>
                                Dodaj część do składu
                                <select id="bomSkuSelect"></select>
                            </label>
                            <label style="max-width: 100px;">
                                Ilość
                                <input id="bomQtyInput" type="number" min="1" step="1" value="1" />
                            </label>
                            <button id="addBomItemBtn" type="button" class="compact">Dodaj / Aktualizuj</button>
                        </div>

                        <div class="tableWrap">
                            <table id="bomTable" class="tightTable">
                                <thead>
                                    <tr>
                                        <th>Część (Nazwa)</th>
                                        <th>Typ</th>
                                        <th class="right">Ilość na 1 szt.</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>

                        <div class="editorActions">
                            <button id="machineEditorSaveBtn" type="button" class="success">Zapisz BOM</button>
                            <button id="machineEditorCancelBtn" type="button" class="secondary">Anuluj</button>
                        </div>
                    </div>

                    <div class="subhead">Lista Maszyn</div>
                    <div class="tableWrap">
                        <table id="machinesCatalogTable">
                            <thead>
                                <tr>
                                    <th>Nazwa (ID)</th>
                                    <th>Typ (Opis)</th>
                                    <th class="right">Liczba części</th>
                                    <th class="right">Akcje</th>
                                </tr>
                            </thead>
                            <tbody id="machinesCatalogBody"></tbody>
                        </table>
                    </div>
                </div>
            </section>


                        <section class="tabPanel" data-tab-panel="history" hidden>
                <div class="card">
                    <div class="cardHeader">
                        <div>
                            <h2>Ostatnie akcje</h2>
                            <p class="small muted" style="margin:6px 0 0">Historia przyjęć dostaw i finalizacji produkcji.</p>
                        </div>
                        <div class="toolbarRight">
                            <button class="secondary compact" id="clearDataBtnHistory" type="button">Resetuj system</button>
                        </div>
                    </div>

                    <div class="toolbar historyToolbar">
                        <input id="historySearch" placeholder="Szukaj po Dostawcy lub Nazwie/Typie części..." type="text" autocomplete="off" />
                        <input id="historyDateRange" class="dateRangeInput" placeholder="01.01.2026-02.01.2026" type="text" inputmode="numeric" autocomplete="off" />

                        <div class="segmented" role="tablist" aria-label="Widok historii">
                            <button id="historyViewDeliveriesBtn" type="button" class="secondary compact" role="tab" aria-selected="true">
                                Dostawy
                            </button>
                            <button id="historyViewBuildsBtn" type="button" class="secondary compact" role="tab" aria-selected="false">
                                Produkcje
                            </button>
                        </div>
                    </div>

                    <div class="tableWrap">
                        <table id="historyTable" class="tightTable stickyHeader">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Szczegóły</th>
                                    <th class="right">Podgląd</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <p class="small muted" style="margin:12px 0 0">
                        Tip: Kliknij „Podgląd”, żeby zobaczyć szczegóły. Filtr dat: wpisz „DD.MM.RRRR-DD.MM.RRRR” albo samo „DD.MM.RRRR”.
                    </p>
                </div>
            </section>

            <footer class="foot muted small">
                Magazyn PRO v2.1 • Dane zapisywane lokalnie w przeglądarce.
            </footer>

        </div>

        <aside class="globalSide" aria-label="Panel boczny">
            <div class="card stickySide">
                <div class="cardHeader">
                    <h2>Panel</h2>
                </div>

                <div class="sideSection">
                    <div class="sideTitle">Status</div>

                    <div class="sideStatus">
                        <div class="sideStatusTop">
                            <span id="sideHealthLabel" class="statusPill ok">OK</span>
                            <span id="sideHealthHint" class="muted small">Brak krytycznych braków</span>
                        </div>

                        <div class="sideCounters">
                            <div class="sideCounter">
                                <div class="muted small">Krytyczne</div>
                                <div class="sideCounterValue" id="sideCriticalCount">0</div>
                            </div>
                            <div class="sideCounter">
                                <div class="muted small">Niskie</div>
                                <div class="sideCounterValue" id="sideLowCount">0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Magazyn: sygnały i metryki -->
                <div class="sideSection">
                    <div class="sideTitle">Magazyn</div>

                    <div class="sideMetric">
                        <div class="metricLabel">Łączna wartość magazynu części</div>
                        <div class="metricValue" id="sideWarehouseTotal">0,00 zł</div>
                    </div>

                    <div class="sideSignals" id="sideMissingSignals" aria-label="Najniższe stany części"></div>
                </div>

                <div class="sideSection">
                    <div class="sideTitle">Ostatnie akcje</div>
                    <ul id="sideRecentActions" class="sideList"></ul>
                </div>

                <div class="sideSection sideUtilities">
                    <div class="sideTitle">Szybkie akcje</div>
                    <button id="themeToggleBtn" type="button" class="secondary sideBtn">Tryb: Ciemny</button>
                </div>

            </div>
        </aside>

    </main>
    <script src="app-core.js"></script>
    <script src="app-ui.js"></script>
    <script src="app-init.js"></script>
</body>
</html>
